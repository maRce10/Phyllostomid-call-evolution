---
title: Measuring degradation
subtitle: LBH song type prevalence and degradation
author: <a href="http://researcher.website.com/">Researcher name</a>
date: "`r Sys.Date()`"
toc: true
toc-depth: 2
toc-location: left
number-sections: true
highlight-style: pygments
format:
  html:
    df-print: kable
    code-fold: show
    code-tools: true
    css: qmd.css
editor_options: 
  chunk_output_type: console
---


<!-- this code add line numbers to code blocks -->
<!-- only works when code folding is not used in yaml (code_folding: show) -->

```{=html}
<style>
body
  { counter-reset: source-line 0; }
pre.numberSource code
  { counter-reset: none; }
</style>
```

```{r set root directory, echo = FALSE}

# set working directory as project directory or one directory above,
rootdir <- try(rprojroot::find_rstudio_root_file(), silent = TRUE)
if (is(rootdir, "try-error")) rootdir <-  ".."
knitr::opts_knit$set(root.dir = rootdir)

```

```{r add link to github repo, echo = FALSE, results='asis'}

# print link to github repo if any
if (file.exists("./.git/config")){
  config <- readLines("./.git/config")
  url <- grep("url",  config, value = TRUE)
  url <- gsub("\\turl = |.git$", "", url)
  cat("\nSource code and data found at [", url, "](", url, ")", sep = "")
  }

```


```{r setup style, echo = FALSE, message = FALSE, warning=FALSE}

# options to customize chunk outputs
knitr::opts_chunk$set(
  class.source = "numberLines lineAnchors", # for code line numbers
  tidy.opts = list(width.cutoff = 65), 
  tidy = TRUE,
  message = FALSE
 )

```


<!-- skyblue box -->
<div class="alert alert-info">

# Purpose

- The first goal of this report

- The second goal of this report

</div>

&nbsp; 


<!-- light brown box -->
<div class="alert alert-warning">

# Report overview

- You can have the sections listed here, for instance:

  - [Lorem ipsum](#lorem-ipsum)
  - [Takeaways](#takeaways)

</div>

&nbsp;

# Load packages

```{r load packages}

# knitr is require for creating html/pdf/word reports
# formatR is used for soft-wrapping code

# install/ load packages
sketchy::load_packages(packages = c("knitr", "formatR", "rprojroot", "warbleR", "readxl", "Rraven"))

```


# Read selection table

```{r}

est <- readRDS("./data/processed/phyllostomid_call_est.RDS")
length(attr(est, 'wave.objects'))

est$sound.files <- gsub("[^[:alnum:]._-]", "", est$sound.files)
est$selec <- 1:nrow(est)

names(attributes(est)$wave.objects) <- gsub("[^[:alnum:]._-]", "",names(attributes(est)$wave.objects))


all(est$sound.files %in% names(attributes(est)$wave.objects) )
all(names(attributes(est)$wave.objects) %in% est$sound.files)

all(est$sound.files %in% names(attributes(est)$wave.objects) )
all(names(attributes(est)$wave.objects) %in% est$sound.files)

attributes(est)$check.results$sound.files <- gsub("[^[:alnum:]._-]", "", attributes(est)$check.results$sound.files)
attributes(est)$check.results$selec <- 1:nrow(attributes(est)$check.results)


wv <- read_wave(X = est, index = 1, from = 0, to = Inf)

spectro(wv)

saveRDS(est, "./data/processed/curated_extended_selection_table.RDS")
```



<!-- light green box -->

<div class="alert alert-success">

# Takeaways {.unnumbered .unlisted}

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vestibulum in felis ut mauris consectetur sodales. Lorem ipsum dolor sit amet, consectetur adipiscing elit.

</div>

&nbsp;

<!-- '---' adds a gray vertical line -->

---

&nbsp; 
 
 <!-- add packages used, system details and versions  -->
 
<font size="4">Session information</font>

```{r session info, echo=F}

sessionInfo()

```
